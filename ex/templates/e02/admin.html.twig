{% extends 'base.html.twig' %}

{% block title %}Panneau d'administration{% endblock %}

{% block body %}
<h1>Panneau d’administration</h1>

{# Message flash pour succès ou erreur #}
{% for label, messages in app.flashes %}
    {% for message in messages %}
        <div class="alert alert-{{ label == 'success' ? 'success' : 'danger' }}">
            {{ message }}
        </div>
    {% endfor %}
{% endfor %}

{# Bouton de création des utilisateurs #}
<form action="{{ path('e02_create_user') }}" method="post">
    <button type="submit" class="btn btn-success mb-4">
        Créer 10 utilisateurs ROLE_USER
    </button>
</form>

{# Liste des utilisateurs #}
<h2>Utilisateurs existants</h2>
{% if users is empty %}
    <p><em>Aucun utilisateur dans la base.</em></p>
{% else %}
    <table class="table table-striped">
        <thead>
            <tr>
                <th>ID</th>
                <th>Nom d'utilisateur</th>
                <th>Rôles</th>
            </tr>
        </thead>
        <tbody>
			{% for user in users %}
				<tr>
					<td>{{ user.id }}</td>
					<td>{{ user.username }}</td>
					<td>{{ user.getRoles()|join(', ') }}</td>
					<td>
						{% if user != app.user and 'ROLE_ADMIN' not in user.getRoles() %}
							<form method="post" action="{{ path('e02_admin_delete', {id: user.id}) }}" onsubmit="return confirm('Supprimer {{ user.username }} ?');">
								<input type="hidden" name="_token" value="{{ csrf_token('delete_user_' ~ user.id) }}">
								<button type="submit" class="btn btn-sm btn-danger">Supprimer</button>
							</form>
						{% else %}
							<em>Non autorisé</em>
						{% endif %}
					</td>
				</tr>
			{% endfor %}
        </tbody>
    </table>
{% endif %}

<a href="{{ path('e02_index') }}" class="btn btn-secondary mt-4">Retour à l'accueil</a>
<a href="{{ path('e02_sign_out') }}" class="btn btn-danger mt-4">Se déconnecter</a>
{% endblock %}