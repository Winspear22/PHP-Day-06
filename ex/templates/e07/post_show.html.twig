{% extends 'base.html.twig' %}

{% block title %}{{ post.title }}{% endblock %}

{% block body %}
<h1>{{ post.title }}</h1>

<p><strong>Auteur :</strong> {{ post.author.username }} (RÃ©putation : {{ post.author.reputation }})</p>
<p><strong>Date :</strong> {{ post.created|date('d/m/Y H:i') }}</p>
{% if post.lastEditedAt and post.lastEditedAt != post.created %}
    <p>
        <strong>ModifiÃ© le :</strong> {{ post.lastEditedAt|date('d/m/Y H:i') }}
        par {{ post.lastEditedBy.username }}
    </p>
{% endif %}

<hr>

<p>{{ post.content }}</p>

<hr>

<h3>Votes</h3>
<p>
    ğŸ‘ {{ post.votes|filter(v => v.isLike())|length }}
    /
    ğŸ‘ {{ post.votes|filter(v => not v.isLike())|length }}
</p>

<ul>
    {% for vote in post.votes %}
        <li>
            {{ vote.user.username }} a votÃ© 
            {% if vote.isLike %}
                <span style="color:green;">ğŸ‘</span>
            {% else %}
                <span style="color:red;">ğŸ‘</span>
            {% endif %}
        </li>
    {% else %}
        <li>Aucun vote pour le moment.</li>
    {% endfor %}
</ul>

<hr>
{% if post.author.id != app.user.id %}
    <a href="{{ path('e07_post_vote', {id: post.id, type: 'like'}) }}" class="btn btn-sm btn-success">ğŸ‘</a>
    <a href="{{ path('e07_post_vote', {id: post.id, type: 'dislike'}) }}" class="btn btn-sm btn-danger">ğŸ‘</a>
{% else %}
    <span class="badge bg-secondary">Tu ne peux pas voter pour ton post</span>
{% endif %}

{% if app.user %}
    {% set isOwner = post.author.id == app.user.id %}
    {% set isAdmin = 'ROLE_ADMIN' in app.user.roles %}
    {% set hasEnoughReputation = app.user.reputation >= 9 %}
    {% set isAuthorAdmin = 'ROLE_ADMIN' in post.author.roles %}

    {% if (isOwner or hasEnoughReputation or isAdmin) and (not isAuthorAdmin or isAdmin) %}
        <a href="{{ path('e07_post_edit', { id: post.id }) }}" class="btn btn-warning">âœï¸ Modifier le post</a>
    {% endif %}
{% endif %}



<a href="{{ path('e07_welcome') }}" class="btn btn-secondary mt-3">â† Retour Ã  lâ€™accueil</a>
{% endblock %}
