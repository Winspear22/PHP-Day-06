{% extends 'base.html.twig' %}

{% block title %}Page de bienvenue{% endblock %}

{% block body %}
<h1>Bienvenue {{ app.user.username }} !</h1>

<p>
    R√¥le : 
    {% if 'ROLE_ADMIN' in app.user.roles %}
        <strong style="color: darkred;">Administrateur</strong>
    {% else %}
        Utilisateur normal
    {% endif %}
    ‚Äî R√©putation : {{ app.user.reputation }}
</p>

<a href="{{ path('e07_sign_out') }}" class="btn btn-danger mt-2">Se d√©connecter</a>
<a href="{{ path('e07_index') }}" class="btn btn-secondary mt-2">Retour</a>

{% if is_granted('IS_AUTHENTICATED_FULLY') %}
    <a href="{{ path('e07_post_new') }}" class="btn btn-primary mt-2">Cr√©er un nouveau post</a>
{% endif %}

<hr>

<h2>Liste des posts</h2>

{% for post in posts %}
    <div class="card mt-4">
        <div class="card-body">
            <h3 class="card-title">
                <a href="{{ path('e07_post_show', { id: post.id }) }}">{{ post.title }}</a>
            </h3>
            <p class="card-subtitle mb-2 text-muted">
                Auteur : {{ post.author.username }} ‚Äî le {{ post.created|date('d/m/Y H:i') }}
            </p>

            <p class="card-text">
                Score :
                üëç {{ post.votes|filter(v => v.isLike())|length }} /
                üëé {{ post.votes|filter(v => not v.isLike())|length }}
            </p>

            {% if post.author.id != app.user.id %}
                {% set rep = app.user.reputation %}
                {% if rep >= 3 %}
                    <a href="{{ path('e07_post_vote', { id: post.id, type: 'like' }) }}" class="btn btn-sm btn-success">üëç</a>
                {% endif %}
                {% if rep >= 6 %}
                    <a href="{{ path('e07_post_vote', { id: post.id, type: 'dislike' }) }}" class="btn btn-sm btn-danger">üëé</a>
                {% endif %}
            {% else %}
                <span class="badge bg-secondary">Tu ne peux pas voter pour ton propre post</span>
            {% endif %}
        </div>
    </div>
{% else %}
    <p>Aucun post pour le moment.</p>
{% endfor %}

{% endblock %}
